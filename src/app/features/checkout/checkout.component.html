<section class="checkout">
  <header class="checkout__header">
    <h1>Checkout</h1>

    @if (cartService.totalItems() === 0) {
      <p class="checkout__notice">Your cart is empty. Add products before checkout.</p>
    } @else {
      <p class="checkout__total">Total: <strong>${{ cartService.totalPrice() }}</strong></p>
    }
  </header>

  <form class="checkout__form" [formGroup]="form" (ngSubmit)="submit()">
    <fieldset class="card" formGroupName="customer">
      <legend class="card__title">Customer</legend>

      <div class="grid grid--2">
        <div class="field">
          <label class="field__label">Full name</label>
          <input class="field__control" formControlName="fullName" />
          @if (form.controls.customer.controls.fullName.touched && form.controls.customer.controls.fullName.invalid) {
            <div class="field__error">Full name is required (min 3).</div>
          }
        </div>

        <div class="field">
          <label class="field__label">Email</label>
          <input class="field__control" formControlName="email" />
          @if (form.controls.customer.controls.email.touched && form.controls.customer.controls.email.invalid) {
            <div class="field__error">Valid email required.</div>
          }
        </div>
      </div>

      <div class="grid grid--2">
        <div class="field">
          <label class="field__label">Phone</label>
          <input class="field__control" formControlName="phone" />
          @if (form.controls.customer.controls.phone.touched && form.controls.customer.controls.phone.invalid) {
            <div class="field__error">Phone required (min 8).</div>
          }
        </div>
        <div class="field field--spacer"></div>
      </div>
    </fieldset>

    <fieldset class="card" formGroupName="shipping">
      <legend class="card__title">Shipping</legend>

      <div class="grid grid--2">
        <div class="field">
          <label class="field__label">Address 1</label>
          <input class="field__control" formControlName="address1" />
          @if (form.controls.shipping.controls.address1.touched && form.controls.shipping.controls.address1.invalid) {
            <div class="field__error">Address is required.</div>
          }
        </div>

        <div class="field">
          <label class="field__label">Address 2</label>
          <input class="field__control" formControlName="address2" />
        </div>
      </div>

      <div class="grid grid--3">
        <div class="field">
          <label class="field__label">City</label>
          <input class="field__control" formControlName="city" />
          @if (form.controls.shipping.controls.city.touched && form.controls.shipping.controls.city.invalid) {
            <div class="field__error">City is required.</div>
          }
        </div>

        <div class="field">
          <label class="field__label">Country</label>
          <input class="field__control" formControlName="country" />
        </div>

        <div class="field">
          <label class="field__label">Postal Code</label>
          <input class="field__control" formControlName="postalCode" />
          @if (form.controls.shipping.controls.postalCode.touched && form.controls.shipping.controls.postalCode.invalid) {
            <div class="field__error">Postal code required (min 4).</div>
          }
        </div>
      </div>
    </fieldset>

    <fieldset class="card" formGroupName="payment">
      <legend class="card__title">Payment (mock)</legend>

      <div class="grid grid--2">
        <div class="field">
          <label class="field__label">Card holder</label>
          <input class="field__control" formControlName="cardHolder" />
        </div>

        <div class="field">
          <label class="field__label">Card number</label>
          <input class="field__control" formControlName="cardNumber" inputmode="numeric" />
        </div>
      </div>

      <div class="grid grid--3">
        <div class="field">
          <label class="field__label">Exp MM</label>
          <input class="field__control" formControlName="expMonth" inputmode="numeric" />
        </div>

        <div class="field">
          <label class="field__label">Exp YY</label>
          <input class="field__control" formControlName="expYear" inputmode="numeric" />
        </div>

        <div class="field">
          <label class="field__label">CVC</label>
          <input class="field__control" formControlName="cvc" inputmode="numeric" />
        </div>
      </div>
    </fieldset>

    <footer class="checkout__actions">
      <button class="btn btn--primary" type="submit" [disabled]="checkoutDisabled()">
        Place order
      </button>
      <button class="btn" type="button" (click)="form.reset()">
        Reset
      </button>
    </footer>
  </form>
</section>
